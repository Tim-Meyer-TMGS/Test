<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Projekt-Index Â· GitHub Verteilseite</title>
<meta name="description" content="Ãœbersichtsseite fÃ¼r GitHub-Repositories mit Suche, Filter und Sortierung." />
<style>
  :root{
    --bg:#0b1020; --panel:#101936; --text:#e9edff; --muted:#aab2d5;
    --line:#1d2748; --accent:#5aa2ff; --card:#0f1834; --ok:#46c28b;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0; font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial; background:var(--bg); color:var(--text)}
  header{padding:28px 20px; border-bottom:1px solid var(--line); background:linear-gradient(180deg, rgba(90,162,255,.12), transparent 30%)}
  .wrap{max-width:1100px; margin:0 auto; padding:0 20px}
  h1{margin:0 6px 6px 0; font-size:clamp(22px,3.5vw,34px)}
  .meta{color:var(--muted); font-size:14px}
  .toolbar{display:grid; grid-template-columns:1fr auto auto; gap:10px; margin-top:16px}
  .toolbar input,.toolbar select{
    background:var(--panel); color:var(--text); border:1px solid var(--line);
    padding:10px 12px; border-radius:10px; font-size:14px
  }
  .section{padding:22px 0}
  h2{font-size:18px; margin:0 0 10px; color:#dfe6ff}
  .grid{display:grid; gap:14px; grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px;
    box-shadow:0 6px 22px rgba(0,0,0,.25); display:flex; flex-direction:column; min-height:160px
  }
  .card h3{margin:0 0 8px; font-size:16px}
  .card p{margin:0 0 10px; color:var(--muted); font-size:14px}
  .tags{display:flex; flex-wrap:wrap; gap:6px; margin-top:auto}
  .tag{font-size:12px; color:var(--muted); border:1px solid var(--line); border-radius:999px; padding:3px 8px}
  .row{display:flex; gap:10px; align-items:center; color:var(--muted); font-size:13px; margin:8px 0 0}
  .row b{color:#cbd6ff; font-weight:600}
  .links{display:flex; gap:10px; margin-top:10px}
  .btn{display:inline-block; padding:8px 10px; border-radius:10px; text-decoration:none; color:var(--text); border:1px solid var(--line); background:transparent}
  .btn:hover{border-color:var(--accent)}
  .empty{color:var(--muted); border:1px dashed var(--line); padding:16px; border-radius:12px}
  footer{color:var(--muted); font-size:12px; padding:24px 20px; border-top:1px solid var(--line)}
  .pill{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid var(--line); font-size:12px; color:var(--muted)}
  .pill.ok{color:var(--ok); border-color:#2f6a54}
  @media (max-width:720px){ .toolbar{grid-template-columns:1fr;}}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Projekt-Index</h1>
    <div class="meta" id="meta">lÃ¤dtâ€¦</div>
    <div class="toolbar">
      <input id="q" type="search" placeholder="Suche in Namen & Beschreibung â€¦ (z. B. â€žqualiâ€œ)" />
      <select id="sort">
        <option value="updated">Sortierung: Zuletzt aktualisiert</option>
        <option value="pushed">Sortierung: Zuletzt gepusht</option>
        <option value="created">Sortierung: Neuste zuerst</option>
        <option value="name">Sortierung: Name Aâ€“Z</option>
        <option value="stars">Sortierung: Sterne â†“</option>
      </select>
      <select id="visibility">
        <option value="all">Alle Repos</option>
        <option value="public">Nur Public</option>
        <option value="private">Nur Private*</option>
      </select>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="section" id="featuredSec" style="display:none">
    <h2>Empfohlen (<span id="featuredCount">0</span>)</h2>
    <div class="grid" id="featured"></div>
  </section>

  <section class="section">
    <h2>Alle Repositories (<span id="count">0</span>)</h2>
    <div class="grid" id="list"></div>
    <div id="empty" class="empty" style="display:none">Keine Repositories gefunden. Passe Suche/Filter an.</div>
  </section>
</main>

<footer class="wrap">
  <span>Generiert client-seitig via GitHub API Â· Kein Build nÃ¶tig Â· <span id="updated"></span></span>
</footer>

<script>
/** ======== KONFIGURATION ======== */
const CONFIG = {
  // ðŸ‘‡ HIER EINTRAGEN: GitHub User ODER Organisation
  owner: "YOUR_GITHUB_OWNER",    // z.B. "TMGSachsen" oder "deinUser"
  // Repos mit diesem PrÃ¤fix werden im â€žEmpfohlenâ€œ-Block hervorgehoben
  featuredPrefix: "quali",        // z.B. "quali", "satourn", "" zum Deaktivieren
  // Optional: nur Repos anzeigen, die mit diesen PrÃ¤fixen anfangen (leer = alle)
  allowedPrefixes: [],            // z.B. ["quali", "satourn"]
  // Optional: Themen/Topics anzeigen? (benÃ¶tigt public Topics)
  showTopics: true
};
/** ================================= */

const els = {
  meta: document.getElementById('meta'),
  list: document.getElementById('list'),
  featured: document.getElementById('featured'),
  featuredSec: document.getElementById('featuredSec'),
  count: document.getElementById('count'),
  featuredCount: document.getElementById('featuredCount'),
  empty: document.getElementById('empty'),
  updated: document.getElementById('updated'),
  q: document.getElementById('q'),
  sort: document.getElementById('sort'),
  visibility: document.getElementById('visibility')
};

const state = {
  all: [],
  filtered: [],
  featured: []
};

function fmtDate(s){ try{ return new Date(s).toLocaleString('de-DE'); }catch{ return s; } }
function esc(s=''){ return String(s).replace(/[&<>]/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[ch])); }
function matchesPrefixes(name, prefixes){
  if (!prefixes || !prefixes.length) return true;
  return prefixes.some(p => name.toLowerCase().startsWith(p.toLowerCase()));
}
function isFeatured(name, prefix){
  if (!prefix) return false;
  return name.toLowerCase().startsWith(prefix.toLowerCase());
}

function card(repo){
  const name = repo.name;
  const desc = repo.description || '';
  const topics = Array.isArray(repo.topics) ? repo.topics.slice(0,6) : [];
  return `
  <article class="card">
    <h3>${esc(name)}</h3>
    <p>${esc(desc)}</p>
    <div class="row">
      <span class="pill">â˜… ${repo.stargazers_count}</span>
      <span class="pill">Forks ${repo.forks_count}</span>
      <span class="pill">Sprache ${esc(repo.language || 'â€”')}</span>
    </div>
    <div class="row">Zuletzt aktualisiert: <b>${fmtDate(repo.updated_at)}</b></div>
    <div class="links">
      <a class="btn" href="${repo.html_url}" target="_blank" rel="noopener">Repo Ã¶ffnen</a>
      ${repo.homepage ? `<a class="btn" href="${repo.homepage}" target="_blank" rel="noopener">Demo/Seite</a>` : ''}
      <a class="btn" href="${repo.html_url}/releases" target="_blank" rel="noopener">Releases</a>
    </div>
    ${CONFIG.showTopics && topics.length ? `<div class="tags">${topics.map(t=>`<span class="tag">#${esc(t)}</span>`).join('')}</div>`:''}
  </article>`;
}

function applyFilters(){
  const q = els.q.value.trim().toLowerCase();
  const vis = els.visibility.value; // "all"|"public"|"private"
  let arr = state.all.slice();

  if (vis !== 'all') {
    arr = arr.filter(r => (vis === 'public') ? !r.private : r.private);
  }
  if (CONFIG.allowedPrefixes && CONFIG.allowedPrefixes.length) {
    arr = arr.filter(r => matchesPrefixes(r.name, CONFIG.allowedPrefixes));
  }
  if (q) {
    arr = arr.filter(r =>
      (r.name && r.name.toLowerCase().includes(q)) ||
      (r.description && r.description.toLowerCase().includes(q))
    );
  }

  // Sort
  const s = els.sort.value;
  arr.sort((a,b)=>{
    if (s === 'name') return a.name.localeCompare(b.name, 'de');
    if (s === 'stars') return (b.stargazers_count|0) - (a.stargazers_count|0);
    if (s === 'pushed') return new Date(b.pushed_at) - new Date(a.pushed_at);
    if (s === 'created') return new Date(b.created_at) - new Date(a.created_at);
    // default: updated
    return new Date(b.updated_at) - new Date(a.updated_at);
  });

  // Featured
  const feat = CONFIG.featuredPrefix ? arr.filter(r => isFeatured(r.name, CONFIG.featuredPrefix)) : [];
  const rest = CONFIG.featuredPrefix ? arr.filter(r => !isFeatured(r.name, CONFIG.featuredPrefix)) : arr;

  state.filtered = rest;
  state.featured = feat;

  render();
}

function render(){
  els.count.textContent = state.filtered.length;
  els.featuredCount.textContent = state.featured.length;
  els.featuredSec.style.display = state.featured.length ? '' : 'none';

  els.featured.innerHTML = state.featured.map(card).join('');
  els.list.innerHTML = state.filtered.map(card).join('');
  els.empty.style.display = (state.filtered.length + state.featured.length) ? 'none' : '';
}

async function fetchAllRepos(owner){
  // List repos for user/org â€“ wir probieren beide Endpunkte.
  const headers = {'Accept': 'application/vnd.github+json'};
  const perPage = 100;
  let repos = [];

  // helper: paginierte Abfrage
  async function fetchPaged(url){
    let page = 1, out = [];
    while (true){
      const res = await fetch(`${url}?per_page=${perPage}&page=${page}`, {headers});
      if (res.status === 404) return []; // falscher Typ (user vs org)
      if (!res.ok) throw new Error('GitHub API Fehler: '+res.status);
      const data = await res.json();
      out = out.concat(data);
      if (data.length < perPage) break;
      page++;
    }
    return out;
  }

  // Versuche Organisation
  repos = await fetchPaged(`https://api.github.com/orgs/${encodeURIComponent(owner)}/repos`);
  if (!repos.length){
    // Versuche Nutzer
    repos = await fetchPaged(`https://api.github.com/users/${encodeURIComponent(owner)}/repos`);
  }

  // Topics extra (benÃ¶tigt pro Repo call)
  if (CONFIG.showTopics && repos.length){
    await Promise.all(repos.map(async r=>{
      try{
        const res = await fetch(`https://api.github.com/repos/${encodeURIComponent(r.owner.login)}/${encodeURIComponent(r.name)}/topics`, {
          headers: {'Accept':'application/vnd.github.mercy-preview+json'}
        });
        if (res.ok){ const t = await res.json(); r.topics = t.names || []; }
      }catch(e){}
    }));
  }
  return repos;
}

function readOwnerFromURL(){
  const u = new URL(location.href);
  const ownerQ = u.searchParams.get('owner');
  return ownerQ || CONFIG.owner;
}

(async function init(){
  const owner = readOwnerFromURL();
  els.meta.textContent = `Quelle: github.com/${owner} Â· (anonymes API-Limit: ~60 Requests/Stunde)`;
  els.updated.textContent = new Date().toLocaleString('de-DE');

  try{
    const repos = await fetchAllRepos(owner);
    state.all = repos;
    applyFilters();
  }catch(e){
    els.list.innerHTML = `<div class="empty">Fehler beim Laden der Repos: ${esc(e.message)}<br>
    PrÃ¼fe den Owner-Namen oder versuche es spÃ¤ter erneut.</div>`;
  }

  ['input','change'].forEach(ev=>{
    els.q.addEventListener(ev, applyFilters);
    els.sort.addEventListener(ev, applyFilters);
    els.visibility.addEventListener(ev, applyFilters);
  });
})();
</script>
</body>
</html>
